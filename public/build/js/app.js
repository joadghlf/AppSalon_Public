let paso=1,pasoInicial=1,pasoFinal=3;const cita={id:"",nombre:"",fecha:"",hora:"",servicios:[]};function iniciarApp(){mostrarSeccion(),tabs(),botonesPaginador(),botonSiguinte(),botonAnterior(),consultarAPI(),idCliente(),nombreCita(),fechaCita(),horaCita()}function tabs(){const e=document.querySelectorAll(".tab");e.length;e.forEach(e=>{e.addEventListener("click",(function(e){paso=parseInt(e.target.dataset.paso),botonesPaginador()}))})}function mostrarSeccion(){document.querySelector("#paso-"+paso).classList.add("display-block");document.querySelector(`[data-paso="${paso}"]`).classList.add("btn-select")}function ocultarSecciones(){const e=document.querySelector(".display-block"),t=document.querySelector(".btn-select");e&&e.classList.remove("display-block"),t&&t.classList.remove("btn-select")}function botonesPaginador(){ocultarSecciones(),mostrarSeccion();const e=document.querySelector("#anterior"),t=document.querySelector("#siguiente");1===paso?(e.classList.add("visibility-hidden"),t.classList.contains("visibility-hidden")&&t.classList.remove("visibility-hidden")):paso===pasoFinal?(t.classList.add("visibility-hidden"),e.classList.contains("visibility-hidden")&&e.classList.remove("visibility-hidden"),mostrarResumen()):document.querySelector(".visibility-hidden")&&document.querySelector(".visibility-hidden").classList.remove("visibility-hidden")}function botonSiguinte(){document.querySelector("#siguiente").addEventListener("click",(function(){paso<pasoFinal&&(paso++,botonesPaginador())}))}function botonAnterior(){document.querySelector("#anterior").addEventListener("click",(function(){paso>pasoInicial&&(paso--,botonesPaginador())}))}async function consultarAPI(){try{const e="http://localhost:3000/api/servicios",t=await fetch(e),o=await t.json();mostrarServicios(o,document.querySelector("#paso-1"))}catch(e){console.log(e)}}function mostrarServicios(e,t){e.forEach(e=>{const{id:o,nombre:i,precio:a}=e,n=document.createElement("P");n.classList.add("nombre-servicio"),n.textContent=i;const r=document.createElement("P");r.classList.add("precio-servicio"),r.textContent="$ "+a;const c=document.createElement("DIV");c.classList.add("servicio"),c.dataset.idServicio=o,c.onclick=function(){selectServicio(e)},c.appendChild(n),c.appendChild(r),t.appendChild(c)})}function selectServicio(e){const{id:t}=e;document.querySelector(`[data-id-servicio="${t}"]`).classList.toggle("btn-select");const{servicios:o}=cita;o.some(e=>e.id===t)?cita.servicios=o.filter(e=>e.id!=t):cita.servicios=[...o,e]}function idCliente(){cita.id=document.querySelector(".formulario #id").value}function nombreCita(){cita.nombre=document.querySelector(".formulario #nombre").value}function fechaCita(){document.querySelector(".formulario #fecha").addEventListener("input",(function(e){const t=new Date(e.target.value).getUTCDay();let o=[];[6,0].includes(t)?(e.target.value="",o.push("Los días sábados y domingos la tienda está cerrada"),mostrarAlerta(o,"error")):cita.fecha=e.target.value}))}function horaCita(){document.querySelector(".formulario #hora").addEventListener("input",(function(e){const t=e.target.value,o=t.split(":");let i=[];o[0]<8||o[0]>19?(e.target.value="",i=["Nuestro horario de atención es de 08:00hs a 20:00hs"],mostrarAlerta(i,"error")):cita.hora=t}))}function mostrarResumen(){const e=document.querySelector(".seccion .mostrar-resumen");let t=[];if(Object.values(cita).includes("")&&t.push("Falta completar información del día y horario"),0==cita.servicios.length&&t.push("Falta elegir al menos un servicio"),t.length>0)return void mostrarAlerta(t,"error");const{nombre:o,fecha:i,hora:a,servicios:n}=cita;for(;e.firstChild;)e.removeChild(e.firstChild);mostrarValor("Nombre:",o,e);const r=new Date(i),c=r.getDate()+2,s=r.getMonth(),d=r.getFullYear();mostrarValor("Fecha:",new Date(Date.UTC(d,s,c)).toLocaleDateString(void 0,{weekday:"long",year:"numeric",month:"long",day:"numeric"}),e),mostrarValor("Hora:",a+" hs",e);const l=document.createElement("H3");l.textContent="Servicios",e.appendChild(l),n.forEach(t=>{const{id:o,nombre:i,precio:a}=t;mostrarValor(a,i,e)});const u=document.createElement("button");u.classList.add("btn"),u.classList.add("btn-primary"),u.onclick=reservarCita,u.textContent="Confirmar reserva",e.appendChild(u)}function mostrarValor(e,t,o){const i=document.createElement("DIV");i.classList.add(e),i.classList.add("grid-1-4"),i.classList.add("text-left"),i.classList.add("display-info");const a=document.createElement("P"),n=document.createElement("P");a.textContent=e,n.textContent=t,i.appendChild(a),i.appendChild(n),o.appendChild(i)}async function reservarCita(){const e=new FormData,{id:t,nombre:o,fecha:i,hora:a,servicios:n}=cita,r=n.map(e=>e.id);e.append("fecha",i),e.append("hora",a),e.append("idusuario",t),e.append("servicios",r);try{const t="http://localhost:3000/api/reservar",o=await fetch(t,{method:"POST",body:e});1==(await o.json()).resultado&&Swal.fire({text:"La cita ha sido realizada",title:"Reserva realizada!",icon:"success"}).then(()=>{window.location.reload()})}catch(e){Swal.fire({text:"Hubo un error, inténtelo más tarde",title:"Error",icon:"error"})}}document.addEventListener("DOMContentLoaded",(function(){iniciarApp()}));